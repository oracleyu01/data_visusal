## **예제16.** 시계열 데이터 시각화 (Time Series Plot)

시계열 데이터 시각화(Time Series Plot)는 시간에 따른 데이터의 변화를 추적하는 시각화 기법으로,
트렌드, 계절성, 순환 패턴 등 시간 기반 패턴을 파악하는 데 효과적이다.
이를 통해 매출, 수익, 주문량과 같은 핵심 지표의 시간적 변화를 분석할 수 있다.

### ■ 시계열 시각화가 언제 필요한가?

- 시간에 따른 지표 변화 추세를 파악할 때 유용하다.
- 계절성, 주기성, 특이점 등 시간적 패턴을 식별하고자 할 때 효과적이다.
  예: 월별/분기별 매출 추이 분석, 일별 웹사이트 트래픽 변화 파악, 연도별 고객 증가율 비교

### ■ 문제: 월별 매출 추이는 어떻게 되며, 어떤 패턴이 있는가?
- 목적:
  - 시간에 따른 매출 변화 추세 분석
  - 계절적 패턴 및 주기성 파악
  - 이상치 및 특이 기간 식별
  - 제품 대분류별 시간적 변화 비교

### - 데이터 로드 및 Plotly 시계열 차트 생성
```python
import pandas as pd
import plotly.express as px
import plotly.graph_objects as go
from plotly.subplots import make_subplots
import numpy as np

# 데이터 로드
df = pd.read_csv("c:\data\SUPERSTORE_2019.csv")

# 날짜 형식으로 변환
df['주문 일자'] = pd.to_datetime(df['주문 일자'])

# 월별 집계 데이터 생성
monthly_sales = df.groupby([pd.Grouper(key='주문 일자', freq='M'), '제품 대분류']).agg({
    '매출': 'sum',
    '수익': 'sum',
    '수량': 'sum'
}).reset_index()

# 시계열 차트 생성 (제품 대분류별 색상 구분)
fig = px.line(monthly_sales, 
              x='주문 일자', 
              y='매출', 
              color='제품 대분류',
              title='월별 제품 대분류별 매출 추이',
              labels={'주문 일자': '월', '매출': '매출액', '제품 대분류': '제품 카테고리'})

# 차트 레이아웃 설정
fig.update_layout(
    xaxis_title='월',
    yaxis_title='매출액',
    legend_title='제품 대분류',
    width=900, 
    height=500
)

# 연도별 구분선 추가
for year in range(2017, 2020):
    fig.add_vline(x=f"{year}-01-01", line_dash="dash", line_color="gray", opacity=0.7)
    fig.add_annotation(x=f"{year}-01-01", y=1.05, yref="paper", text=f"{year}년", showarrow=False)

fig.show()
```

이 시계열 그래프는 2016년부터 2019년까지의 월별 제품 대분류별 매출 추이를 보여줍니다. 
파란색은 가구, 빨간색은 사무기기, 초록색은 사무용품을 나타냅니다.

### 분석 결과:

#### ✅ 전체적인 매출 트렌드
✔ 모든 제품 대분류에서 2016년부터 2019년까지 전반적인 상승 추세가 관찰됩니다.
✔ 2019년에는 모든 카테고리의 매출 규모가 2016년 대비 약 2-3배 증가했습니다.
✔ 특히 2019년 하반기에 모든 제품군의 매출이 동시에 크게 상승하는 패턴이 보입니다.

#### ✅ 계절적 패턴 분석
✔ 모든 제품군에서 연말(11-12월)과 연초(1월)에 매출 상승이 관찰됩니다.
✔ 사무기기(빨간색)는 특히 2018년 7월과 2019년 12월에 가장 높은 매출 피크를 기록했습니다.
✔ 여름철(7-8월)에도 매출 상승 패턴이 보이는데, 이는 중간 결산이나 시즌 프로모션과 연관될 수 있습니다.

#### ✅ 제품군별 비교
✔ 사무기기(빨간색): 가장 변동성이 큰 제품군으로, 최고점과 최저점의 차이가 가장 큽니다. 
                   2018년 7월과 2019년 12월에 약 60M의 최고 매출을 기록했습니다.
✔ 가구(파란색): 가장 안정적인 성장세를 보이며, 특히 2019년 하반기에 꾸준한 상승세를 유지했습니다.
✔ 사무용품(초록색): 세 제품군 중 전반적으로 가장 낮은 매출을 기록했지만, 
                   2019년 하반기에 큰 폭의 성장을 보였습니다.

#### ✅ 주목할 만한 시점
✔ 2018년 7월: 사무기기 매출이 급증한 반면, 가구와 사무용품은 하락했습니다. 
          이는 특별 프로모션이나 대형 주문 때문일 수 있습니다.
✔ 2019년 4월: 가구 매출이 크게 상승했지만 다른 카테고리는 하락했습니다.
✔ 2019년 11-12월: 모든 카테고리가 동시에 큰 폭으로 상승했으며, 특히 사무기기가 최고점을 기록했습니다.

#### ✅ 비즈니스 인사이트
✔ 세 제품군 모두 시간이 지남에 따라 매출 변동성이 증가했습니다. 
   이는 시장 경쟁 심화나 계절적 수요 변화가 더 뚜렷해졌음을 시사합니다.
✔ 세 제품군이 비슷한 시기에 피크와 저점을 보이는 경우가 있어,
   전체 시장을 움직이는 공통 요인(경기 변동, 구매 시즌 등)이 존재함을 알 수 있습니다.
✔ 2019년의 전반적인 매출 증가는 효과적인 마케팅 전략이나 시장 확대를 나타낼 수 있습니다.

### 전략적 제안:
🚀 연말/연초와 여름 시즌에 집중적인 마케팅 및 프로모션을 계획하여 계절적 매출 피크를 더욱 극대화합니다.
🚀 가구 카테고리의 안정적 성장을 유지하면서, 사무기기의 매출 변동성을 줄이기 위한 전략을 수립합니다.
🚀 사무용품의 성장 모멘텀을 활용하여 시장 점유율을 더 확대할 수 있는 방안을 모색합니다.
🚀 모든 제품군이 동시에 하락하는 시점(예: 2018년 초)에 대비한 리스크 관리 전략을 마련합니다.


### 전년 동월 대비 성장률 계산
```python
import pandas as pd
import numpy as np
import plotly.express as px

# 데이터 로드
df = pd.read_csv("c:\data\SUPERSTORE_2019.csv")
df['주문 일자'] = pd.to_datetime(df['주문 일자'])

# 월별 매출 데이터 생성
monthly_sales = df.groupby(pd.Grouper(key='주문 일자', freq='M')).agg({
    '매출': 'sum'
}).reset_index()

# 시계열 인덱스 설정
monthly_sales.set_index('주문 일자', inplace=True)

# 전년 동월 대비 성장률 계산
monthly_sales['전년동월'] = monthly_sales['매출'].shift(12)
monthly_sales['성장률'] = (monthly_sales['매출'] / monthly_sales['전년동월'] - 1) * 100

# 2년 이상의 데이터가 있는 경우만 분석
if len(monthly_sales) >= 24:
    # 성장률 차트 생성
    growth_data = monthly_sales.dropna().reset_index()
    fig_growth = px.bar(
        growth_data, 
        x='주문 일자', 
        y='성장률',
        title='전년 동월 대비 매출 성장률 (%)',
        labels={'주문 일자': '월', '성장률': '성장률 (%)'}
    )
    
    # 0% 기준선 추가
    fig_growth.add_hline(y=0, line_dash="solid", line_color="red")
    
    fig_growth.update_layout(width=900, height=400)
    fig_growth.show()
```

### - 분석 결과 해석

이 그래프는 "전년 동월 대비 매출 성장률 (%)"을 보여주는 막대 그래프입니다. 2017년 중반부터 2020년 초반까지의 월별 매출 성장률 데이터를 시각화하고 있습니다.

### 주요 특징 및 해석:

#### ✅ 전반적인 성장 추세
✔ 대부분의 기간에서 양(+)의 성장률을 보이고 있어, 전반적으로 사업이 성장하고 있음을 알 수 있습니다.
✔ 몇몇 월(2017년 9월, 2018년 5월, 2019년 7월)에서는 음(-)의 성장률이 나타나 전년 동월 대비 매출이 감소했습니다.

#### ✅ 주목할 만한 시점
✔ **2018년 8월**: 약 200%의 매우 높은 성장률을 기록했습니다. 이는 전년도 같은 달 대비 매출이 3배로 증가했음을 의미하며, 특별한 이벤트나 대형 계약 체결 등의 요인이 있었을 가능성이 높습니다.
✔ **2017년 초**: 약 120%의 높은 성장률을 보여 데이터 측정 초기에 급격한 성장이 있었음을 알 수 있습니다.
✔ **2019년 5월**: 약 80%의 높은 성장률을 기록하며 꾸준한 성장세를 유지했습니다.

#### ✅ 계절적 패턴
✔ 연초(1-2월)와 연말(11-12월)에 상대적으로 높은 성장률이 자주 관찰됩니다.
✔ 중간 시기(5-7월)에는 성장률 변동이 크게 나타나는 경향이 있습니다.

#### ✅ 추세 변화
✔ 2018년 중반 이후 성장률이 다소 안정화되는 경향을 보입니다.
✔ 2019년 하반기에 일시적인 하락 후 2020년 초에 다시 성장세로 전환되었습니다.

### 비즈니스 인사이트:

🚀 **극단적 성장 분석**: 2018년 8월과 같은 이례적인 성장이 발생한 원인을 분석하여 
                         성공 요인을 파악하고 재현 가능한 전략을 개발해야 합니다.

🚀 **마이너스 성장 대응**: 성장률이 마이너스인 달에 대한 철저한 원인 분석과 개선 전략이 필요합니다.

🚀 **계절성 활용**: 성장률이 높은 시즌에 맞춰 마케팅 및 판매 전략을 최적화하고, 
                     성장률이 낮은 시즌에 대한 대응 전략을 수립해야 합니다.

🚀 **장기적 성장 안정화**: 그래프 후반부에 성장률이 안정화되는 경향이 보이므로, 
                          지속 가능한 성장을 위한 새로운 성장동력 발굴이 필요할 수 있습니다.

이 그래프는 비즈니스의 성장 패턴과, 특별한 주의가 필요한 시점을 식별하는데 매우 유용한 정보를 제공합니다.


