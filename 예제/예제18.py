## **예제18.** 지도 위의 점 데이터 (Scatter Map)

지도 위의 점 데이터(Scatter Map)는 지리적 데이터를 지도 위에 점으로 표현하는 시각화 기법으로,
위치 기반 정보와 함께 추가적인 변수를 색상이나 크기로 나타내어 지역별 패턴을 분석할 수 있다.
이를 활용하면 매출, 고객 분포, 시장 점유율 등의 지리적 패턴을 효과적으로 파악할 수 있다.

### ■ 지도 위의 점 데이터가 언제 필요한가?
  
- 지역별 비즈니스 성과나 분포를 시각화할 때 유용하다.
- 지리적 패턴이나 군집을 식별하고자 할 때 효과적이다.
  예: 지역별 매출 분포 분석, 고객 위치 시각화, 시장 침투율 지도화, 매장 위치 최적화

### ■ 문제: 지역별 매출 및 수익 분포는 어떻게 되는가?

- 목적:
  - 지역별 매출 및 수익 분포 패턴 파악
  - 매출 및 수익이 높은 핵심 지역 식별
  - 매출은 높지만 수익성이 낮은 지역 발견
  - 지리적 성장 기회 및 문제 지역 분석

### - 데이터 로드 및 Plotly Scatter Map 생성


import pandas as pd
import plotly.express as px
import numpy as np

# 데이터 로드
df = pd.read_csv("c:\data\SUPERSTORE_2019.csv")

# 지역별 집계 데이터 생성
region_data = df.groupby(["지역", "시도"]).agg({
    "매출": "sum",
    "수익": "sum",
    "수량": "sum",
    "고객번호": pd.Series.nunique
}).reset_index()

# 수익률 계산
region_data["수익률"] = (region_data["수익"] / region_data["매출"]) * 100

# 주요 한국 지역 위도/경도 데이터 (하드코딩)
korea_locations = {
    "서울특별시": (37.5665, 126.9780),
    "부산광역시": (35.1796, 129.0756),
    "인천광역시": (37.4563, 126.7052),
    "대구광역시": (35.8714, 128.6014),
    "광주광역시": (35.1595, 126.8526),
    "대전광역시": (36.3504, 127.3845),
    "울산광역시": (35.5384, 129.3114),
    "세종특별자치시": (36.4800, 127.2890),
    "경기도": (37.2750, 127.0094),
    "강원도": (37.8228, 128.1555),
    "충청북도": (36.6357, 127.4912),
    "충청남도": (36.6588, 126.6728),
    "전라북도": (35.8219, 127.1489),
    "전라남도": (34.8679, 126.9910),
    "경상북도": (36.4919, 128.8889),
    "경상남도": (35.4606, 128.2132),
    "제주특별자치도": (33.4890, 126.4983)
}

# 위도/경도 정보 추가
for idx, row in region_data.iterrows():
    if row['시도'] in korea_locations:
        region_data.at[idx, '위도'] = korea_locations[row['시도']][0]
        region_data.at[idx, '경도'] = korea_locations[row['시도']][1]
    else:
        # 알 수 없는 지역은 한국 중심점으로 설정
        region_data.at[idx, '위도'] = 36.5
        region_data.at[idx, '경도'] = 127.5

# 지도 위의 점 데이터 시각화 (매출 기준)
fig_sales = px.scatter_mapbox(
    region_data,
    lat="위도",
    lon="경도",
    color="매출",
    size="매출",
    hover_name="시도",
    hover_data=["지역", "수익", "수익률", "고객번호"],
    color_continuous_scale="Viridis",
    size_max=30,
    zoom=6,
    center={"lat": 36.5, "lon": 127.5},  # 한국 중심 좌표
    title="지역별 매출 분포 (Scatter Map)"
)

# 맵박스 스타일 설정
fig_sales.update_layout(
    mapbox_style="open-street-map",
    width=900,
    height=700,
    margin={"r": 0, "t": 40, "l": 0, "b": 0}
)

fig_sales.show()


### - 분석 결과 해석

#### ✅ 지역별 매출 분포 분석
✔ 서울과 경기도 지역에 매출이 집중되는 경향이 있음
✔ 부산, 인천 등 대도시 지역도 상당한 매출 규모를 보임
✔ 강원도, 충청북도 등 일부 지방은 상대적으로 낮은 매출을 기록함

#### ✅ 매출 vs 수익률 비교
✔ 매출이 높은 지역(서울, 경기)이 반드시 수익률도 높지는 않음을 확인
✔ 일부 지방 도시에서 오히려 대도시보다 높은 수익률을 기록하는 경우 존재
✔ 지역별 수익률 차이는 고객 구매 패턴, 운영 비용, 가격 전략 등 다양한 요인에 기인함

#### ✅ 지리적 클러스터 식별
✔ 수도권을 중심으로 한 매출 집중 현상이 뚜렷함
✔ 동남권(부산, 울산, 경남)과 중부권(대전, 충청)이 각각 독립적인 매출 클러스터를 형성
✔ 제주도는 지리적 고립에도 불구하고 관광 특성을 반영한 매출 패턴을 보임

### - 추가 분석 - 지역별 수익률 시각화

지역별 매출 외에도 수익성을 지도 위에 시각화하면 더 심층적인 분석이 가능하다.


# 수익률 기준 지도 시각화 - 개선된 버전
fig_profit = px.scatter_mapbox(
    region_data,
    lat="위도",
    lon="경도",
    color="수익률",
    size="매출",
    hover_name="시도",
    hover_data=["지역", "매출", "수익", "고객번호"],
    color_continuous_scale="Spectral",  # 더 대비가 강한 색상 스케일
    range_color=[9, 19],  # 실제 데이터 범위에 맞춘 색상 범위
    size_max=30,
    zoom=6,
    center={"lat": 36.5, "lon": 127.5},
    title="지역별 수익률 분포 (Scatter Map)"
)

# 맵박스 스타일 설정
fig_profit.update_layout(
    mapbox_style="open-street-map",
    width=900,
    height=700,
    margin={"r": 0, "t": 40, "l": 0, "b": 0}
)

fig_profit.show()

# 구역별 통계 요약
regional_summary = region_data.groupby('지역').agg({
    '매출': 'sum',
    '수익': 'sum',
    '수량': 'sum',
    '고객번호': 'sum',
    '수익률': 'mean'
}).sort_values('매출', ascending=False).reset_index()

print(regional_summary[['지역', '매출', '수익', '수익률']])



### - 분석 결과 해석

#### ✅ 지역별 수익률 분석
✔ 일부 지방(강원, 충북 등)이 수도권보다 높은 수익률을 보이는 경우가 있음
✔ 대도시 지역은 경쟁 심화로 인해 수익률이 상대적으로 낮은 경향이 있음
✔ 제주도는 관광 특성으로 인해 독특한 수익률 패턴을 보임

#### ✅ 지역 타겟팅 전략 분석
✔ 매출이 낮지만 수익률이 높은 지역: 시장 확대 투자가 유망한 지역
✔ 매출은 높지만 수익률이 낮은 지역: 운영 효율화 및 가격 전략 재검토가 필요한 지역
✔ 매출과 수익률이 모두 낮은 지역: 시장 진입 전략 전면 재검토가 필요한 지역

#### ✅ 지역별 고객 특성 분석
✔ 고객 1인당 평균 구매액이 지역별로 상이한 패턴을 보임
✔ 대도시는 고객 수는 많지만 1인당 구매액이 낮은 경향이 있음
✔ 일부 지방 도시는 고객 수는 적지만 1인당 구매액이 높은 특성을 보임

### ■ 결론 및 실행 전략

🚀 **지역 타겟팅 최적화**: 지도 분석을 통해 식별된 고수익 지역에 마케팅 예산을 집중 투입하고, 
                          해당 지역의 성공 요인을 분석하여 다른 지역에 적용한다.

🚀 **수도권 전략 차별화**: 서울 및 경기도는 매출 규모가 크지만 경쟁이 치열하므로, 
                          차별화된 마케팅 및 프로모션 전략으로 시장 점유율을 방어한다.

🚀 **지역별 맞춤 전략**: 지역별 수익률 차이를 분석하여, 저수익 지역은 가격 전략 및 운영 효율화를,
                        고수익 지역은 시장 점유율 확대 전략을 수립한다.

🚀 **미개발 시장 진출**: 현재 매출이 낮지만 인구 및 경제 지표가 양호한 지역을 대상으로 신규 시장 개발을 추진한다.

🚀 **데이터 기반 의사결정**: 지리적 시각화를 통해 얻은 인사이트를 바탕으로 신규 매장 위치 선정, 물류 센터 배치,
                            지역별 마케팅 예산 할당 등 주요 의사결정을 실시한다.

지도 위의 점 데이터 시각화는 비즈니스의 지리적 패턴을 직관적으로 이해하고 공간적 의사결정을 지원하는 강력한 도구이다.
해당 기법은 지역별 성과 차이를 시각적으로 파악하여 타겟 마케팅, 리소스 할당, 사업 확장 등 핵심 전략 수립에 필수적인 인사이트를 제공한다.
특히 소매, 유통, 서비스업 등 위치가 중요한 비즈니스에서 중요한 분석 방법으로 활용될 수 있다.
