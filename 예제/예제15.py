## **예제15.** 3D 산점도 (3D Scatter Plot)

3D 산점도(3D Scatter Plot)는 세 가지 변수를 동시에 시각화하는 기법으로,
데이터 포인트를 3차원 공간에 배치하여 변수 간의 관계를 입체적으로 표현한다.
이를 통해 매출, 수익, 수량과 같은 여러 지표 간의 복잡한 관계를 보다 효과적으로 파악할 수 있다.

### ■ 3D 산점도가 언제 필요한가?
- 세 가지 연속형 변수 간의 관계를 동시에 분석할 때 유용하다.
- 데이터 클러스터링 패턴을 공간적으로 파악하고자 할 때 효과적이다.
  예: 제품별 매출-수익-수량 관계 분석, 고객별 구매금액-방문빈도-평균 체류시간 분석, 지역별 매출-인구밀도-평균 소득 관계 파악

### ■ 문제: 제품 중분류별 매출, 수익, 수량 간의 관계는 어떠한가?
- 목적:
  - 매출, 수익, 수량 간의 3차원적 관계 파악
  - 고수익-고매출 제품군 식별
  - 이상치 및 특이 패턴을 보이는 제품군 탐색
  - 제품군 별 클러스터링 패턴 분석

### - 데이터 로드 및 Plotly 3D 산점도 생성
```python
import pandas as pd
import plotly.express as px
import numpy as np

# 데이터 로드
df = pd.read_csv("c:\data\SUPERSTORE_2019.csv")

# 제품 중분류별 지표 계산
subcategory_metrics = df.groupby(["제품 대분류", "제품 중분류"]).agg({
    "매출": "sum",
    "수익": "sum",
    "수량": "sum",
    "할인율": "mean"
}).reset_index()

# 3D 산점도 생성
fig = px.scatter_3d(
    subcategory_metrics,
    x="매출",
    y="수익",
    z="수량",
    color="제품 대분류",
    size="매출",  # 점의 크기는 매출에 비례
    hover_name="제품 중분류",
    hover_data=["할인율"],
    opacity=0.7,
    title="제품 중분류별 매출-수익-수량 관계 분석 (3D 산점도)"
)

# 레이아웃 설정
fig.update_layout(
    scene=dict(
        xaxis_title="매출",
        yaxis_title="수익",
        zaxis_title="수량"
    ),
    width=900,
    height=700
)

fig.show()
```

■ 해석 결과

✅ 색상별 클러스터 분석

- 빨간색 클러스터: 두 개의 구분된 그룹이 보입니다.

- 왼쪽 상단: 높은 수량(약 80M)과 낮은 매출(약 500M)을 보이는 제품군으로, 
            저가 대량판매 모델로 보입니다.
- 오른쪽 하단: 낮은 수량(약 40M)과 높은 매출(약 200M)을 보이는 고가 제품군입니다.


파란색 클러스터: 세 개의 뚜렷한 위치에 분포합니다.

- 왼쪽 상단: 높은 수량(약 70M)과 낮은 매출을 보이는 제품군입니다.
- 오른쪽 하단: 낮은 수량과 높은 매출(약 100M)을 보이는 프리미엄 제품으로 보입니다.
- 중앙 하단: 중간 정도의 매출(약 200M)과 매우 낮은 수량을 보이는 특이 케이스입니다.


초록색 클러스터: 주로 오른쪽 영역에 분포하며, 
                 대체로 낮은 수량(20-40M)과 높은 매출(100M-300M)을 보이는 
                 고부가가치 제품군으로 보입니다.

✅ 매출-수익-수량 간 관계 분석

- 왼쪽 상단 영역(높은 수량, 낮은 매출): 대량 판매되지만 단가가 낮은 제품군
- 오른쪽 하단 영역(낮은 수량, 높은 매출): 소량 판매되지만 단가가 높은 프리미엄 제품군
- 매출이 증가함에 따라 일반적으로 수량이 감소하는 경향이 보이며, 이는 고가 제품일수록 판매량이 줄어드는 일반적인 시장 패턴을 반영합니다.

✅ 전략적 인사이트

- 빨간색 제품군: 두 가지 다른 사업 모델(대량 저가와 소량 고가)을 운영 중으로 보입니다. 각 모델에 맞는 차별화된 전략이 필요합니다.
- 파란색 제품군: 가장 넓은 가격대와 판매량 스펙트럼을 보유하고 있어, 다양한 시장 세그먼트를 공략하는 포트폴리오를 갖추고 있습니다.
- 초록색 제품군: 대체로 고부가가치 제품에 집중되어 있어, 프리미엄 시장을 타겟팅하는 전략이 적합합니다.

■ 실행 전략

🚀 차별화된 가격 전략: 각 클러스터별 특성에 맞는 가격 정책을 수립합니다.

- 빨간색 대량판매 제품군: 가격 경쟁력 유지하며 규모의 경제 활용
- 초록색 고부가가치 제품군: 프리미엄 가격 책정 및 품질/서비스 강화

🚀 마케팅 자원 최적화: 각 제품군의 포지셔닝에 맞는 마케팅 전략 수립

- 대량판매 제품: 대중 마케팅 및 가격 프로모션
- 고부가가치 제품: 타겟 마케팅 및 브랜드 이미지 강화

🚀 포트폴리오 조정: 3D 공간에서 비어있는 영역(빈틈) 분석을 통해 신제품 기회 발굴

- 중간 가격대(약 300M-400M 매출)와 중간 수량(40M-60M) 영역에 새로운 제품 라인 개발 검토

이 3D 산점도 분석을 통해 제품별 매출-수익-수량의 관계를 입체적으로 파악하여 
더 효과적인 비즈니스 의사결정을 내릴 수 있습니다.

3D 산점도와 함께 제품 중분류별 단위 수량당 수익률을 계산하여 부가가치가 높은 제품군을 식별할 수 있다.

```python
import pandas as pd
import plotly.express as px
from scipy.stats import pearsonr

# 데이터 로드
df = pd.read_csv("c:\\data\\SUPERSTORE_2019.csv")

# 제품 중분류별 지표 계산 및 단위 수량당 수익 계산
subcategory_metrics = df.groupby(["제품 대분류", "제품 중분류"]).agg({
    "매출": "sum",
    "수익": "sum",
    "수량": "sum",
    "할인율": "mean"
}).reset_index()

# 단위 수량당 수익 및 수익률 계산
subcategory_metrics["단위수량당수익"] = subcategory_metrics["수익"] / subcategory_metrics["수량"]
subcategory_metrics["수익률"] = (subcategory_metrics["수익"] / subcategory_metrics["매출"]) * 100


# 상위 5개 및 하위 5개 단위 수량당 수익 제품 출력
print("\n===== 단위 수량당 수익이 가장 높은 제품 중분류 (상위 5개) =====")
top_unit_profit = subcategory_metrics.sort_values("단위수량당수익", ascending=False).head(5)
print(top_unit_profit[["제품 대분류", "제품 중분류", "단위수량당수익", "수익률", "매출"]])

print("\n===== 단위 수량당 수익이 가장 낮은 제품 중분류 (하위 5개) =====")
bottom_unit_profit = subcategory_metrics.sort_values("단위수량당수익").head(5)
print(bottom_unit_profit[["제품 대분류", "제품 중분류", "단위수량당수익", "수익률", "매출"]])

# 제품 대분류별 평균 단위 수량당 수익 및 평균 수익률 계산
category_avg = subcategory_metrics.groupby("제품 대분류").agg({
    "단위수량당수익": "mean",
    "수익률": "mean",
    "매출": "sum"
}).reset_index()

print("\n===== 제품 대분류별 평균 단위 수량당 수익 및 수익률 =====")
print(category_avg)
```

### - 분석 결과 해석

#### ✅ 단위 수량당 수익 분석
✔ 고부가가치 제품군 식별: 단위 수량당 수익이 높은 제품군은 같은 판매량으로 더 높은 수익 창출
✔ 저부가가치 제품군 파악: 단위 수량당 수익이 낮은 제품군은 대량 판매를 통한 수익 확보 필요
✔ 제품 대분류별 단위 수량당 평균 수익 차이 분석: 어떤 대분류가 효율적인 수익 창출 가능

#### ✅ 수익률 분석 결과
✔ 고수익률 제품군: 매출 대비 수익 비율이 높은 제품군 식별
✔ 저수익률 제품군: 매출은 높지만 수익 전환율이 낮은 제품군 파악
✔ 수익률과 단위 수량당 수익 간의 관계: 둘 다 높은 제품군은 최우선 투자 대상

#### ✅ 제품 포트폴리오 최적화를 위한 인사이트
✔ 매출-수익-수량 3차원 관계에서 이상적인 포지션을 차지하는 제품군 식별
✔ 대분류별 특성 차이 분석: 각 대분류의 강점과 약점 파악
✔ 개선 가능성이 높은 제품군: 수익률은 낮지만 매출/수량이 높은 제품군 전략적 관리

### ■ 결론 및 실행 전략

🚀 3D 산점도를 통해 매출, 수익, 수량 간의 복잡한 관계를 입체적으로 파악하여 더 정확한 의사결정이 가능하다.
🚀 단위 수량당 수익이 높은 고부가가치 제품군에 마케팅 자원을 집중하여 효율적인 수익 창출을 도모한다.
🚀 수익률이 낮은 제품군은 원가 구조 개선, 가격 전략 재검토 등을 통해 수익성을 향상시킨다.
🚀 3차원 공간에서 비슷한 특성을 갖는 제품군을 클러스터링하여 맞춤형 전략을 수립한다.
🚀 이상치로 나타나는 제품군은 심층 분석을 통해 원인을 파악하고 적절한 대응 방안을 마련한다.

3D 산점도는 다차원 데이터 관계를 직관적으로 시각화하여 복잡한 패턴을 파악하는 데 효과적이다.
특히 매출, 수익, 수량과 같은 핵심 비즈니스 지표 간의 관계를 분석하여 
데이터 기반의 제품 포트폴리오 최적화 및 마케팅 전략 수립에 큰 도움이 된다.
